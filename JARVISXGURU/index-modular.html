<!DOCTYPE html>
<!-- GURU Enhanced Stop Commands - Version 2025052603 -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>GURU - Modular Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Advanced Search Engine Integration -->
    <script src="guru-search-engine.js?v=2025052603"></script>
    <!-- Load Modular CSS -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Neural Network Visualization Canvas -->
    <canvas id="neuralCanvas"></canvas>

    <!-- HUD Overlay -->
    <div class="hud-overlay">
        <!-- Status Panel -->
        <div class="status-panel hud-element">
            <div class="guru-font hud-text-lg glow mb-2">GURU</div>
            <div class="hud-text-sm mb-1">
                <span id="systemsStatus" class="status-dot status-online"></span>
                <span id="systemsStatusText">Systems Online</span>
            </div>
            <div class="hud-text-sm mb-1">
                <span id="aiStatus" class="status-dot status-online"></span>
                <span id="aiStatusText">AI Online (Local)</span>
            </div>
            <div class="hud-text-sm">
                <span id="audioStatus" class="status-dot status-listening"></span>
                <span id="audioStatusText">Listening...</span>
            </div>
        </div>

        <!-- System Info -->
        <div class="system-info hud-element">
            <div class="guru-font hud-text-lg glow mb-2">SYSTEM STATUS</div>
            <div class="hud-text-sm">Uptime: <span id="uptime">00:00:00</span></div>
            <div class="hud-text-sm">Provider: <span id="aiProvider">Local</span></div>
            <div class="hud-text-sm">Model: <span id="aiModel">llama3.2</span></div>
            <div class="hud-text-sm">Latency: <span id="latency">-- ms</span></div>
            <div class="hud-text-sm">Memory: <span id="memoryStatus">Ready</span></div>
            <div class="hud-text-sm">Search: <span id="searchStatusDisplay">Enabled</span></div>
            <div class="hud-text-sm">CPU: <span id="cpuUsage">-- %</span></div>
        </div>

        <!-- Connection Status -->
        <div id="connectionPanel" class="connection-status hud-element" style="display: none;">
            <div class="hud-text-sm">üîó Connecting to AI...</div>
        </div>

        <!-- Wake Word Indicator -->
        <div id="wakeIndicator" class="wake-indicator">
            <div class="guru-font hud-text-xl glow-strong mb-2">GURU ACTIVATED</div>
            <div class="hud-text-base">Listening for commands...</div>
        </div>

        <!-- Settings Overlay -->
        <div id="settingsOverlay" class="settings-overlay"></div>

        <!-- Settings Panel -->
        <div id="settingsPanel" class="settings-panel">
            <button class="btn-close" id="closeSettingsBtn">&times;</button>
            <div class="guru-font hud-text-xl glow-strong mb-4">GURU CONFIGURATION</div>
            
            <div class="settings-grid">
                <!-- AI Provider Column -->
                <div class="settings-column">
                    <h3 class="hud-text-lg">ü§ñ AI Provider Configuration</h3>
                    <div class="settings-section">
                        <div class="hud-text-base mb-3">Select AI Provider:</div>
                        
                        <div class="provider-option" data-provider="ollama" id="provider-ollama">
                            <div>
                                <div class="hud-text-base">üñ•Ô∏è Local (Ollama)</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Privacy-focused, runs locally</div>
                            </div>
                            <div class="provider-status" id="ollamaStatus"></div>
                        </div>

                        <div class="settings-section" id="ollamaModelSection" style="display: none;">
                            <div class="hud-text-base mb-2">Ollama Model Configuration:</div>
                            <select id="ollamaModelSelect" class="input-field" style="margin-bottom: 10px;">
                                <option value="">Select a model...</option>
                            </select>
                            <div class="hud-text-sm mb-2" style="color: rgba(0, 212, 255, 0.7);">Or enter model name manually:</div>
                            <input type="text" id="ollamaModelInput" class="input-field" placeholder="e.g., llama3.2, phi3, mistral..." style="margin-bottom: 10px;" />
                            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                <button class="btn" id="refreshModelsBtn" style="padding: 8px 16px; font-size: 12px;">üîÑ Refresh Models</button>
                                <button class="btn" id="setModelBtn" style="padding: 8px 16px; font-size: 12px;">‚úÖ Set Model</button>
                            </div>
                            <div class="hud-text-sm mt-2" style="color: rgba(0, 212, 255, 0.6);">
                                Current model: <span id="currentOllamaModel">None</span>
                            </div>
                        </div>

                        <div class="provider-option" data-provider="gemini-2.5-flash" id="provider-gemini-2.5-flash">
                            <div>
                                <div class="hud-text-base">‚ö° Gemini 2.5 Flash</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Ultra-fast responses, cloud-based</div>
                            </div>
                            <div class="provider-status" id="gemini25Status"></div>
                        </div>

                        <div class="provider-option" data-provider="gemini-2.0-flash" id="provider-gemini-2.0-flash">
                            <div>
                                <div class="hud-text-base">üöÄ Gemini 2.0 Flash</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Advanced reasoning, multimodal</div>
                            </div>
                            <div class="provider-status" id="gemini20Status"></div>
                        </div>

                        <div class="settings-section" id="geminiApiSection" style="display: none;">
                            <div class="hud-text-base mb-2">Gemini API Key:</div>
                            <input type="password" id="geminiApiKey" class="input-field" placeholder="Enter your Gemini API key..." />
                            <div class="hud-text-sm mt-2" style="color: rgba(0, 212, 255, 0.6);">
                                Get from: <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #00d4ff; text-decoration: underline;">Google AI Studio</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Voice Configuration Column -->
                <div class="settings-column">
                    <h3 class="hud-text-lg">üé§ Voice Configuration</h3>
                    <div class="settings-section">
                        <div class="hud-text-base mb-3">Select Voice Provider:</div>
                        
                        <div class="provider-option active" data-voice="elevenlabs" id="voice-elevenlabs">
                            <div>
                                <div class="hud-text-base">üé≠ ElevenLabs (Realistic)</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Ultra-realistic AI voices</div>
                            </div>
                            <div class="provider-status" id="elevenLabsVoiceStatus"></div>
                        </div>

                        <div class="provider-option" data-voice="edge" id="voice-edge">
                            <div>
                                <div class="hud-text-base">üåê Edge TTS (Free)</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Microsoft Edge voices</div>
                            </div>
                            <div class="provider-status connected" id="edgeVoiceStatus"></div>
                        </div>

                        <div id="elevenLabsSection" style="margin-top: 15px;">
                            <div class="hud-text-base mb-2">ElevenLabs API Key:</div>
                            <input type="password" id="elevenLabsApiKey" class="input-field" placeholder="Enter your ElevenLabs API key..." />
                            <div class="hud-text-sm mt-2" style="color: rgba(0, 212, 255, 0.6);">
                                Get your API key from: <a href="https://elevenlabs.io/api" target="_blank" style="color: #00d4ff; text-decoration: underline;">ElevenLabs API</a>
                            </div>
                            
                            <div id="elevenLabsVoiceSection" style="margin-top: 15px; display: none;">
                                <div class="hud-text-base mb-2">Select Voice:</div>
                                <select id="elevenLabsVoiceSelect" class="input-field">
                                    <option value="">Loading voices...</option>
                                </select>
                                <button class="btn" id="loadVoicesBtn" style="margin-top: 10px; padding: 8px 16px; font-size: 12px;">üîÑ Load Voices</button>
                                <div class="hud-text-sm mt-2" style="color: rgba(0, 212, 255, 0.6);">
                                    Current voice: <span id="currentVoiceName">Adam (Professional Male)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Search Configuration Column -->
                <div class="settings-column">
                    <h3 class="hud-text-lg">üåê Internet Search Configuration</h3>
                    <div class="settings-section">
                        <div class="hud-text-base mb-3">Search Settings:</div>
                        
                        <div class="provider-option active" style="margin-bottom: 15px;">
                            <div>
                                <div class="hud-text-base">üó£Ô∏è Conversational Mode</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Advanced VAD & natural conversation</div>
                            </div>
                            <div class="provider-status connected"></div>
                            <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.9); font-weight: bold; margin-top: 5px;">
                                Always Enabled
                            </div>
                        </div>

                        <div class="provider-option" id="searchToggle" style="cursor: pointer;">
                            <div>
                                <div class="hud-text-base">üîç Internet Search</div>
                                <div class="hud-text-sm" style="color: rgba(0, 212, 255, 0.7);">Enable real-time web search</div>
                            </div>
                            <div class="provider-status connected" id="searchStatus"></div>
                        </div>

                        <div class="settings-section" id="searchMethodSection">
                            <div class="hud-text-base mb-2">Primary Search Method:</div>
                            <select id="searchMethodSelect" class="input-field" style="margin-bottom: 10px;">
                                <option value="0">DuckDuckGo Instant Answers (CORS-Safe)</option>
                                <option value="1">Wikipedia API (CORS-Safe)</option>
                                <option value="2">searx.be (SearXNG)</option>
                                <option value="3">searx.tiekoetter.com (SearXNG)</option>
                                <option value="4">searx.work (SearXNG)</option>
                            </select>
                            <div class="hud-text-sm mt-2" style="color: rgba(0, 212, 255, 0.6);">
                                Current method: <span id="currentSearchMethod">DuckDuckGo Instant Answers</span>
                            </div>
                            <button class="btn" id="testSearchBtn" style="margin-top: 10px; padding: 8px 16px; font-size: 12px;">üîç Test All Methods</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="settings-section" style="text-align: center; margin-top: 30px;">
                <button class="btn" id="saveSettingsBtn">üíæ Save Settings</button>
                <button class="btn" id="testConnectionBtn">üîç Test Connection</button>
                <button class="btn" id="toggleSearchBtn">üåê Toggle Search</button>
            </div>
        </div>

        <!-- Subtitle Panel -->
        <div id="subtitlePanel" class="subtitle-panel">
            <div id="subtitleText" class="subtitle-text"></div>
        </div>

        <!-- Audio Visualization -->
        <div class="audio-viz-corner hud-element">
            <div class="hud-text-sm mb-2 text-center">AUDIO</div>
            <div id="audioViz" class="flex items-end justify-center h-8">
                <!-- Audio bars will be generated here -->
            </div>
        </div>

        <!-- Settings Hint -->
        <div class="settings-hint">
            Press <strong>Ctrl+Alt+S</strong> for settings
            <button id="openSettingsBtn" class="settings-button">‚öôÔ∏è Settings</button>
        </div>
    </div>

    <!-- Load Modular JavaScript -->
    <script src="guru-conversation-enhancer.js"></script>
    <script src="jarvis-core.js"></script>
    <script>
        // Initialize the conversation enhancer after JARVIS loads
        window.addEventListener('load', () => {
            // Wait a moment for JARVIS to initialize
            setTimeout(() => {
                if (window.jarvis) {
                    window.guruConversationEnhancer = new GuruConversationEnhancer(window.jarvis);
                    console.log('üó£Ô∏è GURU Conversation Enhancement System activated');
                }
            }, 2000);
        });
        
        // Global keyboard shortcut handler (outside of class context)
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîß Setting up global keyboard shortcuts...');
            
            document.addEventListener('keydown', (e) => {
                // Settings shortcut (Ctrl+Alt+S)
                if (e.ctrlKey && e.altKey && (e.key === 's' || e.key === 'S')) {
                    e.preventDefault();
                    console.log('üîß Global shortcut detected: Ctrl+Alt+S');
                    
                    // Try to access JARVIS and show settings
                    if (window.jarvis && typeof window.jarvis.showSettings === 'function') {
                        window.jarvis.showSettings();
                    } else {
                        console.warn('‚ö†Ô∏è JARVIS not available for settings');
                        // Try to show settings panel directly
                        const panel = document.getElementById('settingsPanel');
                        const overlay = document.getElementById('settingsOverlay');
                        if (panel && overlay) {
                            panel.classList.add('active');
                            overlay.classList.add('active');
                        }
                    }
                }
            });
            
            // Global settings button handler
            setTimeout(() => {
                const openSettingsBtn = document.getElementById('openSettingsBtn');
                if (openSettingsBtn) {
                    openSettingsBtn.addEventListener('click', () => {
                        console.log('üîß Global button click detected');
                        
                        if (window.jarvis && typeof window.jarvis.showSettings === 'function') {
                            window.jarvis.showSettings();
                        } else {
                            console.warn('‚ö†Ô∏è JARVIS not available, showing settings directly');
                            // Try to show settings panel directly
                            const panel = document.getElementById('settingsPanel');
                            const overlay = document.getElementById('settingsOverlay');
                            if (panel && overlay) {
                                panel.classList.add('active');
                                overlay.classList.add('active');
                            }
                        }
                    });
                                         console.log('‚úÖ Global settings button handler attached');
                } else {
                    console.warn('‚ö†Ô∏è Settings button not found');
                }
                
                // Global close settings handler
                const closeSettingsBtn = document.getElementById('closeSettingsBtn');
                if (closeSettingsBtn) {
                    closeSettingsBtn.addEventListener('click', () => {
                        console.log('üîß Global close button detected');
                        const panel = document.getElementById('settingsPanel');
                        const overlay = document.getElementById('settingsOverlay');
                        if (panel && overlay) {
                            panel.classList.remove('active');
                            overlay.classList.remove('active');
                        }
                    });
                }
                
                // Global overlay click to close
                const settingsOverlay = document.getElementById('settingsOverlay');
                if (settingsOverlay) {
                    settingsOverlay.addEventListener('click', () => {
                        console.log('üîß Global overlay click detected');
                        const panel = document.getElementById('settingsPanel');
                        if (panel) {
                            panel.classList.remove('active');
                            settingsOverlay.classList.remove('active');
                        }
                    });
                }
            }, 1000);
        });
    </script>
</body>
</html> 